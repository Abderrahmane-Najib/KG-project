<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Scout Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-main: #f8fafc;
            --bg-white: #ffffff;
            --bg-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* ==================== TEAM SELECTION SCREEN ==================== */
        .team-select-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%);
            padding: 20px;
        }

        .team-select-container {
            background: var(--bg-white);
            border-radius: 24px;
            padding: 48px;
            max-width: 600px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .team-select-logo {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .team-select-logo i {
            font-size: 36px;
            color: white;
        }

        .team-select-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .team-select-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .team-select-dropdown {
            width: 100%;
            padding: 16px 20px;
            font-size: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-white);
            cursor: pointer;
            margin-bottom: 24px;
            font-family: inherit;
        }

        .team-select-dropdown:focus {
            outline: none;
            border-color: var(--primary);
        }

        .team-select-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .team-select-btn:hover {
            background: var(--primary-dark);
        }

        .team-select-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        /* ==================== MAIN APP ==================== */
        .app {
            display: none;
            min-height: 100vh;
        }

        .app.active {
            display: block;
        }

        /* Header */
        .app-header {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .header-team {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
        }

        .header-team:hover {
            background: var(--bg-hover);
        }

        .header-team-name {
            font-weight: 600;
        }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-btn.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        /* Main Content */
        .main-content {
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Section */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .section-subtitle {
            color: var(--text-secondary);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 20px;
        }

        .stat-card-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-card-icon.green { background: #d1fae5; color: #10b981; }
        .stat-card-icon.orange { background: #fed7aa; color: #f59e0b; }
        .stat-card-icon.purple { background: #e9d5ff; color: #8b5cf6; }

        .stat-card-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-card-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Player Cards Grid */
        .players-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .players-section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .position-filter {
            display: flex;
            gap: 8px;
        }

        .position-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--bg-white);
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .position-btn:hover, .position-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        /* Player Card */
        .player-card {
            background: var(--bg-white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.2s;
            cursor: pointer;
        }

        .player-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .player-card-header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%);
            padding: 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .player-avatar {
            width: 56px;
            height: 56px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
        }

        .player-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .player-info span {
            font-size: 13px;
            opacity: 0.8;
        }

        .player-card-body {
            padding: 20px;
        }

        .player-stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .player-stat {
            text-align: center;
        }

        .player-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .player-stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .player-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .player-value {
            font-weight: 700;
            color: var(--success);
        }

        .player-age {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Scout Section */
        .scout-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
        }

        .scout-filters {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .filter-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-title i {
            color: var(--primary);
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .filter-input, .filter-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            background: var(--bg-main);
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-white);
        }

        .filter-range {
            display: flex;
            gap: 12px;
        }

        .filter-range input {
            flex: 1;
        }

        .scout-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            margin-top: 8px;
        }

        .scout-btn:hover {
            background: var(--primary-dark);
        }

        .scout-results {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Results Table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            border-bottom: 2px solid var(--border);
        }

        .results-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .results-table tr:hover {
            background: var(--bg-hover);
        }

        .player-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-cell-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .player-cell-name {
            font-weight: 600;
        }

        .player-cell-team {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-position {
            background: var(--primary-light);
            color: var(--primary);
        }

        .badge-value {
            background: #d1fae5;
            color: #059669;
        }

        .action-btn {
            padding: 8px 16px;
            border: 1px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* AI Chat Section */
        .chat-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 24px;
            height: calc(100vh - 180px);
        }

        .chat-main {
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .chat-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            max-width: 80%;
        }

        .message.user {
            flex-direction: row-reverse;
            margin-left: auto;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message.assistant .message-avatar {
            background: var(--primary);
            color: white;
        }

        .message.user .message-avatar {
            background: var(--text-primary);
            color: white;
        }

        .message-content {
            background: var(--bg-main);
            padding: 14px 18px;
            border-radius: 16px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .chat-input-area {
            padding: 20px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .chat-send-btn {
            padding: 14px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
        }

        .chat-send-btn:hover {
            background: var(--primary-dark);
        }

        .chat-suggestions {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .suggestions-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .suggestion-btn {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: 10px;
            text-align: left;
            font-size: 13px;
            cursor: pointer;
            margin-bottom: 10px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .suggestion-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        /* Compare Section */
        .compare-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .compare-slot {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            min-height: 500px;
        }

        .compare-slot-header {
            margin-bottom: 16px;
        }

        .compare-slot-header h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .compare-search-filters {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .compare-player-content {
            min-height: 300px;
        }

        .compare-results-list {
            max-height: 350px;
            overflow-y: auto;
        }

        .compare-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .compare-result-item:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .compare-result-item.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .compare-result-info {
            flex: 1;
        }

        .compare-result-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .compare-result-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .compare-result-stats {
            text-align: right;
            font-size: 13px;
        }

        .compare-empty {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            padding: 40px;
        }

        .compare-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .compare-player-card {
            text-align: center;
            padding: 20px;
        }

        .compare-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 16px;
            object-fit: cover;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
        }

        .compare-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .compare-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .compare-position {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .compare-stats {
            display: grid;
            gap: 12px;
            text-align: left;
        }

        .compare-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .compare-stat-label {
            color: var(--text-secondary);
        }

        .compare-stat-value {
            font-weight: 600;
            font-size: 16px;
        }

        .compare-analysis {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow);
        }

        .compare-analysis h3 {
            margin-bottom: 16px;
            font-size: 18px;
        }

        .compare-btn {
            width: 100%;
            margin-top: 16px;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
        }

        .compare-btn:hover {
            background: var(--primary-dark);
        }

        /* Compare Tabs */
        .compare-tabs {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .compare-tab {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .compare-tab:hover {
            border-color: var(--primary);
        }

        .compare-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .compare-tab-content {
            margin-top: 16px;
        }

        /* Player Image Styles */
        .player-avatar-img {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            background: rgba(255,255,255,0.2);
        }

        .player-avatar-fallback {
            width: 56px;
            height: 56px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: white;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .scout-container {
                grid-template-columns: 1fr;
            }

            .scout-filters {
                position: static;
            }

            .chat-container {
                grid-template-columns: 1fr;
            }

            .chat-suggestions {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .compare-container {
                grid-template-columns: 1fr;
            }

            .header-nav {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Team Selection Screen -->
    <div class="team-select-screen" id="team-select-screen">
        <div class="team-select-container">
            <div class="team-select-logo">
                <i class="fas fa-futbol"></i>
            </div>
            <h1 class="team-select-title">Football Scout Pro</h1>
            <p class="team-select-subtitle">Select your team to start scouting</p>

            <select class="team-select-dropdown" id="team-dropdown">
                <option value="">Choose your team...</option>
            </select>

            <button class="team-select-btn" id="team-select-btn" disabled>
                <i class="fas fa-arrow-right"></i>
                Continue to Dashboard
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="main-app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <div class="header-logo">
                    <i class="fas fa-futbol"></i>
                </div>
                <div class="header-team" id="header-team" onclick="changeTeam()">
                    <img id="current-team-logo" src="" alt="" style="width: 32px; height: 32px; border-radius: 50%; display: none; object-fit: contain; background: white;">
                    <i class="fas fa-shield-alt" id="team-icon-fallback"></i>
                    <span class="header-team-name" id="current-team-name">Select Team</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>

            <nav class="header-nav">
                <button class="nav-btn active" data-section="squad">
                    <i class="fas fa-users"></i>
                    My Squad
                </button>
                <button class="nav-btn" data-section="scout">
                    <i class="fas fa-search"></i>
                    Scout Players
                </button>
                <button class="nav-btn" data-section="compare">
                    <i class="fas fa-balance-scale"></i>
                    Compare
                </button>
                <button class="nav-btn" data-section="chat">
                    <i class="fas fa-robot"></i>
                    AI Assistant
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Squad Section -->
            <section class="section active" id="squad-section">
                <div class="section-header">
                    <h1 class="section-title">Squad Overview</h1>
                    <p class="section-subtitle">Analyze your team's strengths and identify areas for improvement</p>
                </div>

                <div class="stats-grid" id="squad-stats">
                    <div class="stat-card">
                        <div class="stat-card-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-card-value" id="stat-players">--</div>
                        <div class="stat-card-label">Squad Size</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon green">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-card-value" id="stat-value">--</div>
                        <div class="stat-card-label">Squad Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon orange">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="stat-card-value" id="stat-age">--</div>
                        <div class="stat-card-label">Average Age</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-icon purple">
                            <i class="fas fa-futbol"></i>
                        </div>
                        <div class="stat-card-value" id="stat-goals">--</div>
                        <div class="stat-card-label">Total Goals</div>
                    </div>
                </div>

                <div class="players-section-header">
                    <h2 class="players-section-title">Players</h2>
                    <div class="position-filter">
                        <button class="position-btn active" data-pos="all">All</button>
                        <button class="position-btn" data-pos="Goalkeeper">GK</button>
                        <button class="position-btn" data-pos="Back">DEF</button>
                        <button class="position-btn" data-pos="Midfield">MID</button>
                        <button class="position-btn" data-pos="Forward">FWD</button>
                    </div>
                </div>

                <div class="players-grid" id="squad-players">
                    <!-- Player cards will be inserted here -->
                </div>
            </section>

            <!-- Scout Section -->
            <section class="section" id="scout-section">
                <div class="section-header">
                    <h1 class="section-title">Scout Players</h1>
                    <p class="section-subtitle">Find the perfect players to strengthen your squad</p>
                </div>

                <div class="scout-container">
                    <div class="scout-filters">
                        <div class="filter-title">
                            <i class="fas fa-filter"></i>
                            Search Filters
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">Position</label>
                            <select class="filter-select" id="scout-position">
                                <option value="">All Positions</option>
                                <optgroup label="Goalkeepers">
                                    <option value="Goalkeeper">Goalkeeper</option>
                                </optgroup>
                                <optgroup label="Defenders">
                                    <option value="Centre-Back">Centre-Back</option>
                                    <option value="Left-Back">Left-Back</option>
                                    <option value="Right-Back">Right-Back</option>
                                    <option value="Defender">Defender (General)</option>
                                </optgroup>
                                <optgroup label="Midfielders">
                                    <option value="Defensive Midfield">Defensive Midfield</option>
                                    <option value="Central Midfield">Central Midfield</option>
                                    <option value="Attacking Midfield">Attacking Midfield</option>
                                    <option value="Left Midfield">Left Midfield</option>
                                    <option value="Right Midfield">Right Midfield</option>
                                    <option value="Midfield">Midfield (General)</option>
                                </optgroup>
                                <optgroup label="Forwards">
                                    <option value="Left Winger">Left Winger</option>
                                    <option value="Right Winger">Right Winger</option>
                                    <option value="Centre-Forward">Centre-Forward</option>
                                    <option value="Attack">Attack (General)</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">Nationality</label>
                            <select class="filter-select" id="scout-nationality">
                                <option value="">All Nationalities</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">Age Range</label>
                            <div class="filter-range">
                                <input type="number" class="filter-input" id="scout-min-age" placeholder="Min" min="15" max="45">
                                <input type="number" class="filter-input" id="scout-max-age" placeholder="Max" min="15" max="45">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">Max Market Value</label>
                            <select class="filter-select" id="scout-max-value">
                                <option value="">Any</option>
                                <option value="100000">€100k</option>
                                <option value="250000">€250k</option>
                                <option value="500000">€500k</option>
                                <option value="750000">€750k</option>
                                <option value="1000000">€1M</option>
                                <option value="2000000">€2M</option>
                                <option value="5000000">€5M</option>
                                <option value="10000000">€10M</option>
                            </select>
                        </div>

                        <button class="scout-btn" onclick="searchPlayers()">
                            <i class="fas fa-search"></i>
                            Search Players
                        </button>
                    </div>

                    <div class="scout-results">
                        <div class="results-header">
                            <h3>Results</h3>
                            <span class="results-count" id="results-count">0 players found</span>
                        </div>
                        <div id="scout-results-body">
                            <div class="empty-state">
                                <i class="fas fa-search"></i>
                                <p>Use filters to find players</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Compare Section -->
            <section class="section" id="compare-section">
                <div class="section-header">
                    <h1 class="section-title">Compare Players</h1>
                    <p class="section-subtitle">Compare your players with potential transfer targets</p>
                </div>

                <div class="compare-container">
                    <!-- Your Player (Left Side) -->
                    <div class="compare-slot" id="compare-slot-1">
                        <div class="compare-slot-header">
                            <h3><i class="fas fa-user" style="margin-right: 8px;"></i>Your Player</h3>
                            <select class="filter-select" id="your-player-select" onchange="selectYourPlayer()">
                                <option value="">Select from your squad...</option>
                            </select>
                        </div>
                        <div class="compare-player-content" id="compare-content-1">
                            <div class="compare-empty">
                                <i class="fas fa-user"></i>
                                <p>Select a player from your squad</p>
                            </div>
                        </div>
                    </div>

                    <!-- Target Player (Right Side) -->
                    <div class="compare-slot" id="compare-slot-2">
                        <div class="compare-slot-header">
                            <h3><i class="fas fa-exchange-alt" style="margin-right: 8px;"></i>Compare With</h3>
                            <div class="compare-tabs">
                                <button class="compare-tab active" onclick="switchCompareTab('squad')">My Squad</button>
                                <button class="compare-tab" onclick="switchCompareTab('market')">Transfer Market</button>
                            </div>
                        </div>

                        <!-- Squad Tab -->
                        <div class="compare-tab-content" id="compare-tab-squad">
                            <select class="filter-select" id="squad-compare-select" onchange="selectSquadPlayer()">
                                <option value="">Select teammate to compare...</option>
                            </select>
                            <div id="squad-compare-list" style="margin-top: 12px;"></div>
                        </div>

                        <!-- Market Tab -->
                        <div class="compare-tab-content" id="compare-tab-market" style="display: none;">
                            <div class="compare-search-filters">
                                <select class="filter-select" id="compare-position">
                                    <option value="">Same Position</option>
                                    <optgroup label="Goalkeepers">
                                        <option value="Goalkeeper">Goalkeeper</option>
                                    </optgroup>
                                    <optgroup label="Defenders">
                                        <option value="Centre-Back">Centre-Back</option>
                                        <option value="Left-Back">Left-Back</option>
                                        <option value="Right-Back">Right-Back</option>
                                        <option value="Defender">Defender (General)</option>
                                    </optgroup>
                                    <optgroup label="Midfielders">
                                        <option value="Defensive Midfield">Defensive Midfield</option>
                                        <option value="Central Midfield">Central Midfield</option>
                                        <option value="Attacking Midfield">Attacking Midfield</option>
                                        <option value="Left Midfield">Left Midfield</option>
                                        <option value="Right Midfield">Right Midfield</option>
                                        <option value="Midfield">Midfield (General)</option>
                                    </optgroup>
                                    <optgroup label="Forwards">
                                        <option value="Left Winger">Left Winger</option>
                                        <option value="Right Winger">Right Winger</option>
                                        <option value="Centre-Forward">Centre-Forward</option>
                                        <option value="Attack">Attack (General)</option>
                                    </optgroup>
                                </select>
                                <div class="filter-range" style="margin-top: 10px;">
                                    <input type="number" class="filter-input" id="compare-min-age" placeholder="Min Age">
                                    <input type="number" class="filter-input" id="compare-max-age" placeholder="Max Age">
                                </div>
                                <select class="filter-select" id="compare-max-value" style="margin-top: 10px;">
                                    <option value="">Any Value</option>
                                    <option value="100000">Up to €100k</option>
                                    <option value="250000">Up to €250k</option>
                                    <option value="500000">Up to €500k</option>
                                    <option value="750000">Up to €750k</option>
                                    <option value="1000000">Up to €1M</option>
                                    <option value="2000000">Up to €2M</option>
                                    <option value="5000000">Up to €5M</option>
                                    <option value="10000000">Up to €10M</option>
                                </select>
                                <button class="scout-btn" style="margin-top: 10px;" onclick="searchReplacements()">
                                    <i class="fas fa-search"></i> Search Market
                                </button>
                            </div>
                            <div class="compare-results-list" id="compare-results"></div>
                        </div>

                        <div class="compare-player-content" id="compare-content-2"></div>
                    </div>
                </div>

                <!-- Compare Button -->
                <div id="compare-action" style="display: none; text-align: center; margin-top: 20px;">
                    <button class="scout-btn" onclick="runComparison()" style="padding: 14px 40px; font-size: 16px;">
                        <i class="fas fa-robot" style="margin-right: 8px;"></i> Analyze Comparison
                    </button>
                </div>

                <!-- AI Comparison Result -->
                <div class="compare-analysis" id="compare-analysis" style="display: none;">
                    <h3><i class="fas fa-robot" style="margin-right: 8px; color: var(--primary);"></i>AI Analysis</h3>
                    <div id="compare-analysis-content"></div>
                </div>
            </section>

            <!-- Chat Section -->
            <section class="section" id="chat-section">
                <div class="chat-container">
                    <div class="chat-main">
                        <div class="chat-header">
                            <h3><i class="fas fa-robot" style="margin-right: 8px; color: var(--primary);"></i>AI Scout Assistant</h3>
                        </div>
                        <div class="chat-messages" id="chat-messages">
                            <div class="message assistant">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    Hi! I'm your AI scouting assistant. I can help you find players, analyze your squad, and suggest transfers. Try asking me something like:
                                    <br><br>
                                    "Who should we sign to improve our attack?"<br>
                                    "Find me affordable young midfielders"<br>
                                    "What positions do we need to strengthen?"
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <textarea class="chat-input" id="chat-input" placeholder="Ask about players, transfers, or squad analysis..." rows="1"></textarea>
                            <button class="chat-send-btn" onclick="sendChat()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chat-suggestions">
                        <div class="suggestions-title">Quick Questions</div>
                        <button class="suggestion-btn" onclick="askSuggestion(this)">Who are our top scorers?</button>
                        <button class="suggestion-btn" onclick="askSuggestion(this)">Which positions need strengthening?</button>
                        <button class="suggestion-btn" onclick="askSuggestion(this)">Find young talents under €500k</button>
                        <button class="suggestion-btn" onclick="askSuggestion(this)">Compare our squad to the league average</button>
                        <button class="suggestion-btn" onclick="askSuggestion(this)">Who has the best goals per game ratio?</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // State
        let currentTeam = null;
        let squadPlayers = [];
        let compareSlots = [null, null];

        const API_BASE = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTeams();
            setupNavigation();
            setupPositionFilter();
            setupChatInput();
        });

        // Load teams for dropdown
        async function loadTeams() {
            try {
                const response = await fetch(`${API_BASE}/api/filters`);
                const data = await response.json();

                const dropdown = document.getElementById('team-dropdown');
                const nationalitySelect = document.getElementById('scout-nationality');

                // Store teams data for later use
                window.teamsData = {};
                data.teams.forEach(team => {
                    window.teamsData[team.id] = team;
                    dropdown.innerHTML += `<option value="${team.id}">${team.name}</option>`;
                });

                data.nationalities.forEach(nat => {
                    nationalitySelect.innerHTML += `<option value="${nat}">${nat}</option>`;
                });
            } catch (error) {
                console.error('Failed to load teams:', error);
            }
        }

        // Team selection
        document.getElementById('team-dropdown').addEventListener('change', function() {
            document.getElementById('team-select-btn').disabled = !this.value;
        });

        document.getElementById('team-select-btn').addEventListener('click', function() {
            const dropdown = document.getElementById('team-dropdown');
            const teamId = dropdown.value;

            // Get full team data including sofascore_id
            const teamData = window.teamsData[teamId] || {};
            currentTeam = {
                id: teamId,
                name: teamData.name || dropdown.options[dropdown.selectedIndex].text,
                sofascore_id: teamData.sofascore_id
            };

            document.getElementById('team-select-screen').style.display = 'none';
            document.getElementById('main-app').classList.add('active');
            document.getElementById('current-team-name').textContent = currentTeam.name;

            // Set team logo if available
            if (currentTeam.sofascore_id) {
                const logoImg = document.getElementById('current-team-logo');
                logoImg.src = `/api/team-image/${currentTeam.sofascore_id}`;
                logoImg.style.display = 'block';
                logoImg.onerror = function() {
                    this.style.display = 'none';
                    document.getElementById('team-icon-fallback').style.display = 'inline';
                };
                document.getElementById('team-icon-fallback').style.display = 'none';
            } else {
                document.getElementById('current-team-logo').style.display = 'none';
                document.getElementById('team-icon-fallback').style.display = 'inline';
            }

            loadSquad();
        });

        function changeTeam() {
            document.getElementById('team-select-screen').style.display = 'flex';
            document.getElementById('main-app').classList.remove('active');
        }

        // Load squad data
        async function loadSquad() {
            try {
                const response = await fetch(`${API_BASE}/api/team/${currentTeam.id}`);
                const data = await response.json();

                // Update stats
                document.getElementById('stat-players').textContent = data.player_count;
                document.getElementById('stat-value').textContent = data.total_value;
                document.getElementById('stat-age').textContent = data.avg_age.toFixed(1);
                document.getElementById('stat-goals').textContent = data.total_goals || 0;

                // Store and render players
                squadPlayers = data.players;
                renderSquadPlayers(squadPlayers);
            } catch (error) {
                console.error('Failed to load squad:', error);
            }
        }

        // Helper function to get player image (uses proxy to avoid CORS)
        function getPlayerImage(player, size = 56) {
            // Convert sofascore_id to integer (it may be stored as float)
            const ssId = player.sofascore_id ? Math.floor(Number(player.sofascore_id)) : null;
            const initial = (player.name || 'U')[0];

            if (ssId) {
                // Use our proxy endpoint instead of direct SofaScore URL
                return `<img class="player-avatar-img"
                             src="/api/player-image/${ssId}"
                             onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';"
                             alt="${player.name}"
                             style="width:${size}px;height:${size}px;border-radius:50%;object-fit:cover;">
                        <div class="player-avatar-fallback" style="width:${size}px;height:${size}px;font-size:${size/2.5}px;display:none;">${initial}</div>`;
            }
            return `<div class="player-avatar-fallback" style="width:${size}px;height:${size}px;font-size:${size/2.5}px;">${initial}</div>`;
        }

        // Switch compare tabs
        function switchCompareTab(tab) {
            document.querySelectorAll('.compare-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('compare-tab-squad').style.display = tab === 'squad' ? 'block' : 'none';
            document.getElementById('compare-tab-market').style.display = tab === 'market' ? 'block' : 'none';

            // If squad tab and we have a player selected, show same position players
            if (tab === 'squad' && compareSlots[0]) {
                showSamePositionSquadPlayers();
            }
        }

        // Show same position players from squad
        function showSamePositionSquadPlayers() {
            const selectedPlayer = compareSlots[0];
            if (!selectedPlayer) return;

            const position = selectedPlayer.position || '';
            const samePosition = squadPlayers.filter(p =>
                p.id !== selectedPlayer.id &&
                (p.position || '').toLowerCase().includes(position.split(' ')[0].toLowerCase())
            );

            const container = document.getElementById('squad-compare-list');
            if (samePosition.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No other players in same position</p>';
                return;
            }

            container.innerHTML = samePosition.map((p, i) => `
                <div class="compare-result-item" data-player-idx="${i}" data-source="squad">
                    ${getPlayerImage(p, 40)}
                    <div class="compare-result-info">
                        <div class="compare-result-name">${p.name}</div>
                        <div class="compare-result-meta">${p.position || 'N/A'} • ${p.age || '--'} yrs</div>
                    </div>
                    <div class="compare-result-stats">
                        <div><strong>${p.goals || 0}</strong> G / <strong>${p.assists || 0}</strong> A</div>
                    </div>
                </div>
            `).join('');

            // Store for click handler
            window.samePositionPlayers = samePosition;

            // Add click handlers
            container.querySelectorAll('.compare-result-item').forEach(el => {
                el.addEventListener('click', function() {
                    const idx = parseInt(this.dataset.playerIdx);
                    selectTargetPlayer(window.samePositionPlayers[idx]);
                    container.querySelectorAll('.compare-result-item').forEach(e => e.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Also populate dropdown
            const select = document.getElementById('squad-compare-select');
            select.innerHTML = '<option value="">Select teammate to compare...</option>';
            squadPlayers.filter(p => p.id !== selectedPlayer.id).forEach((p, idx) => {
                select.innerHTML += `<option value="${idx}">${p.name} (${p.position || 'N/A'})</option>`;
            });
        }

        // Select squad player from dropdown
        function selectSquadPlayer() {
            const select = document.getElementById('squad-compare-select');
            const idx = select.value;
            if (idx === '') return;

            const filteredPlayers = squadPlayers.filter(p => p.id !== compareSlots[0]?.id);
            const player = filteredPlayers[parseInt(idx)];
            if (player) {
                selectTargetPlayer(player);
            }
        }

        function renderSquadPlayers(players) {
            const container = document.getElementById('squad-players');

            if (!players || players.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><p>No players found</p></div>';
                return;
            }

            container.innerHTML = players.map(p => `
                <div class="player-card" onclick="addToCompare(${JSON.stringify(p).replace(/"/g, '&quot;')})">
                    <div class="player-card-header">
                        ${getPlayerImage(p)}
                        <div class="player-info">
                            <h3>${p.name || 'Unknown'}</h3>
                            <span>${p.position || 'N/A'}</span>
                        </div>
                    </div>
                    <div class="player-card-body">
                        <div class="player-stats-row">
                            <div class="player-stat">
                                <div class="player-stat-value">${p.goals || 0}</div>
                                <div class="player-stat-label">Goals</div>
                            </div>
                            <div class="player-stat">
                                <div class="player-stat-value">${p.assists || 0}</div>
                                <div class="player-stat-label">Assists</div>
                            </div>
                            <div class="player-stat">
                                <div class="player-stat-value">${p.age || '--'}</div>
                                <div class="player-stat-label">Age</div>
                            </div>
                        </div>
                        <div class="player-card-footer">
                            <span class="player-value">${p.value || p.market_value || 'N/A'}</span>
                            <span class="player-age">${p.nationality || ''}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // Also populate the compare dropdown
            populateYourPlayerDropdown(players);
        }

        // Populate the "Your Player" dropdown in compare section
        function populateYourPlayerDropdown(players) {
            const select = document.getElementById('your-player-select');
            select.innerHTML = '<option value="">Select from your squad...</option>';
            players.forEach((p, idx) => {
                select.innerHTML += `<option value="${idx}">${p.name} (${p.position || 'N/A'})</option>`;
            });
        }

        // Handle selecting your player for comparison
        function selectYourPlayer() {
            const select = document.getElementById('your-player-select');
            const idx = select.value;

            if (idx === '') {
                document.getElementById('compare-content-1').innerHTML = `
                    <div class="compare-empty">
                        <i class="fas fa-user"></i>
                        <p>Select a player from your squad</p>
                    </div>
                `;
                compareSlots[0] = null;
                compareSlots[1] = null;
                document.getElementById('compare-content-2').innerHTML = '';
                document.getElementById('compare-analysis').style.display = 'none';
                return;
            }

            const player = squadPlayers[parseInt(idx)];
            compareSlots[0] = player;
            compareSlots[1] = null;
            renderComparePlayer(1, player);

            // Clear slot 2
            document.getElementById('compare-content-2').innerHTML = '';
            document.getElementById('compare-analysis').style.display = 'none';

            // Auto-set position filter for market tab
            if (player.position) {
                const posSelect = document.getElementById('compare-position');
                for (let opt of posSelect.options) {
                    if (player.position.includes(opt.value) || opt.value.includes(player.position.split(' ')[0])) {
                        posSelect.value = opt.value;
                        break;
                    }
                }
            }

            // Show same position players in squad tab
            showSamePositionSquadPlayers();
        }

        // Render a player in compare slot
        function renderComparePlayer(slot, player) {
            const container = document.getElementById(`compare-content-${slot}`);
            const ssId = player.sofascore_id ? Math.floor(Number(player.sofascore_id)) : null;
            const initial = (player.name || 'U')[0];

            let avatarHtml;
            if (ssId) {
                // Use proxy endpoint
                avatarHtml = `<img src="/api/player-image/${ssId}"
                                  style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin:0 auto 16px;display:block;"
                                  onerror="this.onerror=null; this.outerHTML='<div class=\\'compare-avatar\\'>${initial}</div>'">`;
            } else {
                avatarHtml = `<div class="compare-avatar">${initial}</div>`;
            }

            container.innerHTML = `
                <div class="compare-player-card">
                    ${avatarHtml}
                    <div class="compare-name">${player.name}</div>
                    <div class="compare-position">${player.position || 'N/A'}</div>
                    <div class="compare-stats">
                        <div class="compare-stat-row">
                            <span class="compare-stat-label">Age</span>
                            <span class="compare-stat-value">${player.age || '--'}</span>
                        </div>
                        <div class="compare-stat-row">
                            <span class="compare-stat-label">Nationality</span>
                            <span class="compare-stat-value">${player.nationality || 'N/A'}</span>
                        </div>
                        <div class="compare-stat-row">
                            <span class="compare-stat-label">Value</span>
                            <span class="compare-stat-value">${player.market_value || player.value || 'N/A'}</span>
                        </div>
                        <div class="compare-stat-row">
                            <span class="compare-stat-label">Goals</span>
                            <span class="compare-stat-value">${player.goals || 0}</span>
                        </div>
                        <div class="compare-stat-row">
                            <span class="compare-stat-label">Assists</span>
                            <span class="compare-stat-value">${player.assists || 0}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Search for replacement players
        async function searchReplacements() {
            const position = document.getElementById('compare-position').value ||
                            (compareSlots[0]?.position || '');
            const minAge = document.getElementById('compare-min-age').value;
            const maxAge = document.getElementById('compare-max-age').value;
            const maxValue = document.getElementById('compare-max-value').value;

            const resultsDiv = document.getElementById('compare-results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/players/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        position: position,
                        min_age: minAge || null,
                        max_age: maxAge || null,
                        max_value: maxValue || null,
                        exclude_team: currentTeam?.id  // Don't show players from your team
                    })
                });
                const data = await response.json();

                if (data.players.length === 0) {
                    resultsDiv.innerHTML = '<div class="compare-empty"><i class="fas fa-search"></i><p>No players found</p></div>';
                    return;
                }

                const players = data.players.slice(0, 10);
                window.marketSearchResults = players;

                resultsDiv.innerHTML = players.map((p, i) => `
                    <div class="compare-result-item" data-player-idx="${i}" data-source="market">
                        ${getPlayerImage(p, 40)}
                        <div class="compare-result-info">
                            <div class="compare-result-name">${p.name}</div>
                            <div class="compare-result-meta">${p.team || 'Free Agent'} • ${p.age || '--'} yrs</div>
                        </div>
                        <div class="compare-result-stats">
                            <div><strong>${p.goals || 0}</strong> goals</div>
                            <div>${p.market_value || 'N/A'}</div>
                        </div>
                    </div>
                `).join('');

                // Add click handlers
                resultsDiv.querySelectorAll('.compare-result-item').forEach(el => {
                    el.addEventListener('click', function() {
                        const idx = parseInt(this.dataset.playerIdx);
                        selectTargetPlayer(window.marketSearchResults[idx]);
                        resultsDiv.querySelectorAll('.compare-result-item').forEach(e => e.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            } catch (error) {
                resultsDiv.innerHTML = '<div class="compare-empty"><i class="fas fa-exclamation"></i><p>Error loading players</p></div>';
            }
        }

        // Select target player for comparison
        function selectTargetPlayer(player) {
            compareSlots[1] = player;

            // Show player card in slot 2
            renderComparePlayer(2, player);

            // Trigger AI comparison
            checkAndRunComparison();
        }

        // Check if both players selected - show analyze button
        function checkAndRunComparison() {
            const actionDiv = document.getElementById('compare-action');
            const analysisDiv = document.getElementById('compare-analysis');

            if (!compareSlots[0] || !compareSlots[1]) {
                actionDiv.style.display = 'none';
                analysisDiv.style.display = 'none';
                return;
            }

            // Show the analyze button
            actionDiv.style.display = 'block';
            analysisDiv.style.display = 'none';
        }

        // Run AI comparison when button clicked
        async function runComparison() {
            if (!compareSlots[0] || !compareSlots[1]) return;

            const actionDiv = document.getElementById('compare-action');
            const analysisDiv = document.getElementById('compare-analysis');
            const contentDiv = document.getElementById('compare-analysis-content');

            // Hide button, show loading
            actionDiv.style.display = 'none';
            analysisDiv.style.display = 'block';
            contentDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/compare`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ players: compareSlots })
                });
                const data = await response.json();
                contentDiv.innerHTML = data.analysis;
            } catch (error) {
                contentDiv.innerHTML = '<p>Error getting comparison analysis.</p>';
                actionDiv.style.display = 'block'; // Show button again on error
            }
        }

        // Navigation
        function setupNavigation() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.dataset.section;

                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${section}-section`).classList.add('active');
                });
            });
        }

        // Position filter
        function setupPositionFilter() {
            document.querySelectorAll('.position-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.position-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const pos = this.dataset.pos;
                    if (pos === 'all') {
                        renderSquadPlayers(squadPlayers);
                    } else {
                        const filtered = squadPlayers.filter(p =>
                            p.position && p.position.includes(pos)
                        );
                        renderSquadPlayers(filtered);
                    }
                });
            });
        }

        // Scout search
        async function searchPlayers() {
            const filters = {
                position: document.getElementById('scout-position').value || null,
                nationality: document.getElementById('scout-nationality').value || null,
                min_age: parseInt(document.getElementById('scout-min-age').value) || null,
                max_age: parseInt(document.getElementById('scout-max-age').value) || null,
                max_value: parseInt(document.getElementById('scout-max-value').value) || null
            };

            console.log('Search filters:', filters); // Debug

            const resultsBody = document.getElementById('scout-results-body');
            resultsBody.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/players/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(filters)
                });
                const data = await response.json();

                document.getElementById('results-count').textContent = `${data.players.length} players found`;

                if (data.players.length === 0) {
                    resultsBody.innerHTML = '<div class="empty-state"><i class="fas fa-user-slash"></i><p>No players match your criteria</p></div>';
                    return;
                }

                resultsBody.innerHTML = `
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Position</th>
                                <th>Age</th>
                                <th>Value</th>
                                <th>Goals</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.players.map(p => `
                                <tr>
                                    <td>
                                        <div class="player-cell">
                                            <div class="player-cell-avatar">${(p.name || 'U')[0]}</div>
                                            <div>
                                                <div class="player-cell-name">${p.name}</div>
                                                <div class="player-cell-team">${p.nationality || 'Unknown'}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="badge badge-position">${p.position || 'N/A'}</span></td>
                                    <td>${p.age || '--'}</td>
                                    <td><span class="badge badge-value">${p.market_value || 'N/A'}</span></td>
                                    <td>${p.goals || 0}</td>
                                    <td>
                                        <button class="action-btn" onclick='addToCompare(${JSON.stringify(p)})'>
                                            Compare
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                resultsBody.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-circle"></i><p>Error loading results</p></div>';
            }
        }

        // Compare
        function addToCompare(player) {
            const slot = compareSlots[0] === null ? 0 : (compareSlots[1] === null ? 1 : 0);
            compareSlots[slot] = player;
            renderCompareSlot(slot, player);

            // Switch to compare section
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-section="compare"]').classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('compare-section').classList.add('active');
        }

        function renderCompareSlot(slot, player) {
            const el = document.getElementById(`compare-slot-${slot + 1}`);
            el.innerHTML = `
                <div class="compare-player-header">
                    <div class="compare-avatar">${(player.name || 'U')[0]}</div>
                    <div class="compare-name">${player.name}</div>
                    <div class="compare-position">${player.position || 'N/A'}</div>
                </div>
                <div class="compare-stats">
                    <div class="compare-stat-row">
                        <span class="compare-stat-label">Age</span>
                        <span class="compare-stat-value">${player.age || '--'}</span>
                    </div>
                    <div class="compare-stat-row">
                        <span class="compare-stat-label">Nationality</span>
                        <span class="compare-stat-value">${player.nationality || 'N/A'}</span>
                    </div>
                    <div class="compare-stat-row">
                        <span class="compare-stat-label">Market Value</span>
                        <span class="compare-stat-value">${player.market_value || player.value || 'N/A'}</span>
                    </div>
                    <div class="compare-stat-row">
                        <span class="compare-stat-label">Goals</span>
                        <span class="compare-stat-value">${player.goals || 0}</span>
                    </div>
                    <div class="compare-stat-row">
                        <span class="compare-stat-label">Assists</span>
                        <span class="compare-stat-value">${player.assists || 0}</span>
                    </div>
                </div>
                <button class="action-btn" style="margin-top: 20px; width: 100%;" onclick="clearCompareSlot(${slot})">
                    <i class="fas fa-times"></i> Remove
                </button>
            `;
        }

        function clearCompareSlot(slot) {
            compareSlots[slot] = null;
            document.getElementById(`compare-slot-${slot + 1}`).innerHTML = `
                <div class="compare-empty">
                    <i class="fas fa-user-plus"></i>
                    <p>Select a player to compare</p>
                    <button class="action-btn" style="margin-top: 16px;">Add Player</button>
                </div>
            `;
        }

        // Chat
        function setupChatInput() {
            document.getElementById('chat-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChat();
                }
            });
        }

        function askSuggestion(btn) {
            document.getElementById('chat-input').value = btn.textContent;
            sendChat();
        }

        async function sendChat() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById('chat-messages');

            // Add user message
            messagesDiv.innerHTML += `
                <div class="message user">
                    <div class="message-avatar"><i class="fas fa-user"></i></div>
                    <div class="message-content">${message}</div>
                </div>
            `;

            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Add loading
            const loadingId = Date.now();
            messagesDiv.innerHTML += `
                <div class="message assistant" id="msg-${loadingId}">
                    <div class="message-avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content"><div class="loading"><div class="spinner"></div></div></div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                const response = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        team_id: currentTeam?.id
                    })
                });
                const data = await response.json();
                document.getElementById(`msg-${loadingId}`).querySelector('.message-content').innerHTML = data.response;
            } catch (error) {
                document.getElementById(`msg-${loadingId}`).querySelector('.message-content').innerHTML = 'Sorry, I encountered an error. Please try again.';
            }

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>
